---
title: "kafka"
date: 2011-12-23T13:05:31Z
draft: true
---

# kafka

![kafka1](/image/kafka1.png)

## 概念说明

### topic

存储记录流，一个主题可以有多个消费者

### record

每个记录包含一个key, value, timestamp

### producer

生产者将记录发布到主题的某个分区中，可以简单的轮询方式实现负载均衡

### consumer

订阅一个或多个主题，并处理接收到的记录，消费者必须归属于一个消费者组，一条记录只会发送到消费者组里的一个消费者，这页可以实现简单的负载均衡

### partition

一个主题可以有多个分区，不同分区可以存储在不同的服务器上

一个分区有一个`leader`服务器，和零个或多个`follower`服务器，`leader`负责读写分区，`follower`负责备份分区\
当`leader`服务器发生故障，`follower`会自动变成`leader`服务器

kafka逻辑示意图

![kafka2](/image/kafka2.png)

上图显示：一个主题有4个分区，分布在两个服务器上，2个消费者组，6个消费者

生产者可轮询发布记录到4个分区中实现负载均衡

每个记录都会发送给2个消费者组，每个组中只有一个消费者接收到记录

## kafka作为消息系统使用

传统的消息系统一般有两种模型

* 队列模型
* 发布-订阅模型

队列模型的特点是，消费者自己取，可以多个消费者同时消费一个队列，这也是一个负载均衡的例子，每个消费者处理不同的消息

发布-订阅模型的特点是: 消息会广播给多个消费者，每个消费者处理相同的消息，这无法实现负载均衡

这两种模型的对立的

kafka的模型结合了这两种模型

对于把消费者组看成一个消费者，那么多个消费者组都可以消费所有消息，这是发布-订阅模型

在一个消费者组内，多个(子)消费者消费不同的消息，这是队列模型

## 示例-golang
